# ML-Assignment2-Q5 ç›®éŒ„æ¶æ§‹èˆ‡å¯¦ä½œæµç¨‹

## ğŸ“‚ ç›®éŒ„çµæ§‹æ¦‚è¦½

```
ML-Assignment2-Q5/
â”œâ”€â”€ minizero/          # ğŸ® éŠæˆ²å¼•æ“æ ¸å¿ƒ (åŠ©æ•™æä¾›ï¼Œå®Œæ•´)
â”œâ”€â”€ style_detection/   # ğŸ¯ ä½œæ¥­æ ¸å¿ƒ (åŠ©æ•™åŠå®Œæˆï¼Œä½ è¦å¡«ç©º)
â”œâ”€â”€ build/             # ğŸ”§ ç·¨è­¯è¼¸å‡ºç›®éŒ„ (è‡ªå‹•ç”Ÿæˆ)
â”œâ”€â”€ scripts/           # ğŸš€ è‡ªå‹•åŒ–è…³æœ¬ (åŠ©æ•™æä¾›)
â””â”€â”€ conf.cfg           # âš™ï¸ è¨­å®šæª”
```

---

## ğŸ® 1. minizero/ - éŠæˆ²å¼•æ“æ ¸å¿ƒ

### **è·è²¬**
å®Œæ•´çš„ AlphaZero/MuZero å¼·åŒ–å­¸ç¿’æ¡†æ¶ï¼Œæ”¯æ´å¤šç¨®æ£‹é¡éŠæˆ²ã€‚

### **çµæ§‹**
```
minizero/
â”œâ”€â”€ minizero/
â”‚   â”œâ”€â”€ actor/          # MCTS æœå°‹å¼•æ“
â”‚   â”œâ”€â”€ console/        # å‘½ä»¤åˆ—ä»‹é¢
â”‚   â”œâ”€â”€ environment/    # éŠæˆ²ç’°å¢ƒ â­â­â­
â”‚   â”‚   â”œâ”€â”€ go/         # åœæ£‹è¦å‰‡å¯¦ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ go.cpp  # å®Œæ•´åœæ£‹é‚è¼¯
â”‚   â”‚   â”‚   â””â”€â”€ go.h    # (æå­ã€åŠ«ã€æ°£ç­‰)
â”‚   â”‚   â””â”€â”€ ...         # å…¶ä»–éŠæˆ²
â”‚   â”œâ”€â”€ network/        # ç¥ç¶“ç¶²è·¯ä»‹é¢
â”‚   â”œâ”€â”€ learner/        # è¨“ç·´é‚è¼¯
â”‚   â”‚   â””â”€â”€ data_loader.cpp  # åŸºç¤è³‡æ–™è¼‰å…¥å™¨
â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½å¼
â””â”€â”€ CMakeLists.txt
```

### **åœ¨æµç¨‹ä¸­çš„ä½ç½®**
```
éšæ®µ 0: åŸºç¤è¨­æ–½ (ä½ ä¸éœ€è¦æ”¹)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ minizero/ æä¾›:                              â”‚
â”‚ âœ… åœæ£‹è¦å‰‡å¼•æ“ (19Ã—19, æå­, åŠ«, æ°£)        â”‚
â”‚ âœ… SGF æª”æ¡ˆè§£æ                              â”‚
â”‚ âœ… æ£‹ç›¤ç‹€æ…‹ç®¡ç†                              â”‚
â”‚ âœ… AlphaZero ç¶²è·¯æ¶æ§‹åŸºç¤                    â”‚
â”‚ âœ… å¤šåŸ·è¡Œç·’è³‡æ–™è¼‰å…¥å™¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (è¢« style_detection ä½¿ç”¨)
```

### **é—œéµæª”æ¡ˆ**
- `minizero/environment/go/go.cpp` - å®Œæ•´åœæ£‹è¦å‰‡
- `minizero/learner/data_loader.cpp` - è³‡æ–™è¼‰å…¥åŸºé¡
- `minizero/utils/sgf_loader.h` - SGF è§£æå™¨

---

## ğŸ¯ 2. style_detection/ - ä½œæ¥­æ ¸å¿ƒ (ä½ çš„å·¥ä½œå€)

### **è·è²¬**
å¯¦ä½œæ£‹é¢¨æª¢æ¸¬çš„ç‰¹å®šåŠŸèƒ½ï¼ŒåŸºæ–¼ minizero æ¡†æ¶ã€‚

### **çµæ§‹**
```
style_detection/
â”œâ”€â”€ code/                      # Python è¨“ç·´ç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ encoder/
â”‚   â”‚   â”œâ”€â”€ model.py          # âš ï¸ ç©ºç™½ - ä½ è¦å¯¦ä½œç¥ç¶“ç¶²è·¯
â”‚   â”‚   â””â”€â”€ train.py          # âœ… åŠ©æ•™å®Œæˆ - è¨“ç·´æ¡†æ¶
â”‚   â”œâ”€â”€ testing.py            # âš ï¸ ç¯„æœ¬ - ä½ è¦è£œå®Œæ¨è«–é‚è¼¯
â”‚   â””â”€â”€ train.py              # âœ… åŠ©æ•™å®Œæˆ - è¨“ç·´å…¥å£
â”‚
â”œâ”€â”€ sd_data_loader.cpp/h       # âœ… åŠ©æ•™å®Œæˆ - è³‡æ–™è¼‰å…¥å™¨
â”œâ”€â”€ sd_mode_handler.cpp/h      # âš ï¸ æœ‰ TODO - SGF è¼‰å…¥
â”œâ”€â”€ sd_configuration.cpp/h     # âœ… åŠ©æ•™å®Œæˆ - è¨­å®šç®¡ç†
â”œâ”€â”€ pybind.cpp                 # âœ… åŠ©æ•™å®Œæˆ - Python ç¶å®š
â”œâ”€â”€ main.cpp                   # âœ… åŠ©æ•™å®Œæˆ - C++ ä¸»ç¨‹å¼
â””â”€â”€ CMakeLists.txt             # âœ… åŠ©æ•™å®Œæˆ - ç·¨è­¯è¨­å®š
```

### **åœ¨æµç¨‹ä¸­çš„ä½ç½®**
```
éšæ®µ 1: è³‡æ–™æº–å‚™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sd_data_loader.cpp (C++)                    â”‚
â”‚ â†“ ä½¿ç”¨ minizero å¼•æ“                        â”‚
â”‚ âœ… è¼‰å…¥ SGF æª”æ¡ˆ                            â”‚
â”‚ âœ… æå–æ£‹ç›¤ç‰¹å¾µ (n_frames Ã— channels)       â”‚
â”‚ âœ… è½‰æ›ç‚º Tensor                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ pybind.cpp (Python â†” C++ æ©‹æ¥)
         
éšæ®µ 2: æ¨¡å‹è¨“ç·´ (Python)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ code/train.py                               â”‚
â”‚ â†“                                           â”‚
â”‚ code/encoder/train.py                       â”‚
â”‚ â”œâ”€ MinizeroDataset (âœ… å®Œæˆ)               â”‚
â”‚ â”‚   â””â”€ å‘¼å« style_py.DataLoader            â”‚
â”‚ â””â”€ model.py (âš ï¸ ä½ è¦å¯¦ä½œ)                  â”‚
â”‚     â””â”€ Encoder é¡åˆ¥                         â”‚
â”‚         â”œâ”€ __init__() - å®šç¾©ç¶²è·¯çµæ§‹        â”‚
â”‚         â”œâ”€ forward() - å‰å‘å‚³æ’­             â”‚
â”‚         â””â”€ loss() - æå¤±å‡½æ•¸                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
         
éšæ®µ 3: æ¸¬è©¦æ¨è«– (Python)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ code/testing.py (âš ï¸ ä½ è¦è£œå®Œ)              â”‚
â”‚ â”œâ”€ load query_set (600 ç©å®¶)               â”‚
â”‚ â”œâ”€ æå– embeddings                          â”‚
â”‚ â”œâ”€ load candidate_set (600 ç©å®¶)           â”‚
â”‚ â”œâ”€ è¨ˆç®—ç›¸ä¼¼åº¦                               â”‚
â”‚ â””â”€ ç”Ÿæˆ submission.csv                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ä½ éœ€è¦å®Œæˆçš„éƒ¨åˆ†**

#### âš ï¸ **å¿…é ˆå¯¦ä½œ**
1. **`code/encoder/model.py`** - ç¥ç¶“ç¶²è·¯æ¶æ§‹
   ```python
   class Encoder(nn.Module):
       def __init__(self, loss_device, conf_file, game_type):
           # è®€å–è¨­å®š
           # å®šç¾© CNN layers
           # å®šç¾© embedding layer
           
       def forward(self, inputs):
           # (batch, n_frames, channels, 19, 19)
           # â†’ CNN è™•ç†
           # â†’ è¼¸å‡º embedding (batch, embedding_dim)
           
       def loss(self, embeddings, labels):
           # Triplet Loss æˆ–å…¶ä»–åº¦é‡å­¸ç¿’æå¤±
   ```

2. **`code/testing.py`** - è£œå®Œæ¨è«–é‚è¼¯
   ```python
   def testing(self):
       # 1. è¼‰å…¥ query_set
       # 2. æå–æ‰€æœ‰ query embeddings
       # 3. è¼‰å…¥ candidate_set
       # 4. æå–æ‰€æœ‰ candidate embeddings
       # 5. è¨ˆç®— cosine similarity
       # 6. è¼¸å‡º submission.csv
   ```

#### âš ï¸ **å¯é¸å¯¦ä½œ**
3. **`sd_mode_handler.cpp:42`** - SGF è¼‰å…¥ (å¦‚æœè¦ç”¨ C++ ä¸»ç¨‹å¼)
   ```cpp
   std::vector<EnvironmentLoader> SDModeHandler::loadEnvironmentLoaders()
   {
       // TODO: read sgf
       // è®€å– SGF æª”æ¡ˆä¸¦è½‰æ›ç‚º EnvironmentLoader
   }
   ```

---

## ğŸ”§ 3. build/ - ç·¨è­¯è¼¸å‡ºç›®éŒ„

### **è·è²¬**
å­˜æ”¾ç·¨è­¯ç”¢ç”Ÿçš„äºŒé€²ä½æª”æ¡ˆå’Œ Python æ¨¡çµ„ã€‚

### **çµæ§‹**
```
build/
â””â”€â”€ go/                        # ç·¨è­¯éŠæˆ²é¡å‹ç‚º go
    â”œâ”€â”€ Makefile               # è‡ªå‹•ç”Ÿæˆ
    â”œâ”€â”€ CMakeCache.txt         # CMake å¿«å–
    â”œâ”€â”€ style_go               # C++ ä¸»ç¨‹å¼ (å¯åŸ·è¡Œæª”)
    â”œâ”€â”€ style_py.*.so          # â­â­â­ Python æ¨¡çµ„ (æœ€é‡è¦!)
    â”œâ”€â”€ minizero/              # minizero ç·¨è­¯ç”¢ç‰©
    â”‚   â””â”€â”€ libminizero.a
    â””â”€â”€ style_detection/       # style_detection ç·¨è­¯ç”¢ç‰©
        â””â”€â”€ *.o
```

### **åœ¨æµç¨‹ä¸­çš„ä½ç½®**
```
ç·¨è­¯éšæ®µ (scripts/build.sh)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¼¸å…¥: *.cpp, *.h, CMakeLists.txt            â”‚
â”‚   â†“ CMake é…ç½®                               â”‚
â”‚   â†“ Make ç·¨è­¯                                â”‚
â”‚ è¼¸å‡º: build/go/                              â”‚
â”‚   â”œâ”€â”€ style_py.*.so  â­ Python å¯ import    â”‚
â”‚   â””â”€â”€ style_go       (C++ ç¨ç«‹ç¨‹å¼)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
Python ç¨‹å¼ç¢¼å¯ä»¥é€™æ¨£ç”¨:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ import build.go.style_py as style_py        â”‚
â”‚ style_py.load_config_file("conf.cfg")       â”‚
â”‚ data_loader = style_py.DataLoader(...)      â”‚
â”‚ features = data_loader.get_feature(...)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **é—œéµæª”æ¡ˆ**
- **`build/go/style_py.cpython-*.so`** - Python å¯å°å…¥çš„ C++ æ¨¡çµ„
  - é€™æ˜¯é€£æ¥ Python å’Œ C++ çš„æ©‹æ¨‘
  - é€šé pybind11 ç”Ÿæˆ
  - æä¾› `DataLoader`, `Environment` ç­‰é¡åˆ¥çµ¦ Python

---

## ğŸš€ 4. scripts/ - è‡ªå‹•åŒ–è…³æœ¬

### **è·è²¬**
æä¾›ä¾¿åˆ©çš„è‡ªå‹•åŒ–å·¥å…·ï¼Œç°¡åŒ–ç·¨è­¯ã€å®¹å™¨ç®¡ç†ã€è¨“ç·´ç­‰æ“ä½œã€‚

### **æª”æ¡ˆ**
```
scripts/
â”œâ”€â”€ build.sh              # ğŸ”¨ ç·¨è­¯è…³æœ¬
â”œâ”€â”€ start-container.sh    # ğŸ³ å•Ÿå‹• container
â””â”€â”€ train-sl.sh           # ğŸ“ è¨“ç·´è…³æœ¬ (ç¯„ä¾‹)
```

### **è©³ç´°èªªæ˜**

#### **build.sh** - ç·¨è­¯è…³æœ¬
```bash
# ç”¨é€”: ç·¨è­¯æ•´å€‹å°ˆæ¡ˆ
# èªæ³•: ./scripts/build.sh <game_type> [build_type]

# æµç¨‹:
./scripts/build.sh go release
  â†“
1. å»ºç«‹ build/go/ ç›®éŒ„
2. åŸ·è¡Œ CMake é…ç½®
   - è¨­å®š GAME_TYPE=GO
   - æ‰¾ PyTorch, pybind11
3. åŸ·è¡Œ Make ç·¨è­¯
   - ç·¨è­¯ minizero
   - ç·¨è­¯ style_detection
   - ç”Ÿæˆ style_py.so
4. è¼¸å‡ºåˆ° build/go/
```

#### **start-container.sh** - Container ç®¡ç†
```bash
# ç”¨é€”: å•Ÿå‹• Docker/Podman container
# å…§å®¹:
./minizero/scripts/start-container.sh \
  -v $(pwd):/strength-detection \
  --image docker.io/kds285/strength-detection

# åŠŸèƒ½:
- æ›è¼‰ç•¶å‰ç›®éŒ„åˆ° container
- å•Ÿå‹•åŒ…å«æ‰€æœ‰ä¾è³´çš„ç’°å¢ƒ
- åœ¨ container å…§åŸ·è¡Œç·¨è­¯å’Œè¨“ç·´
```

#### **train-sl.sh** - è¨“ç·´ç¯„ä¾‹
```bash
# ç”¨é€”: å±•ç¤ºå¦‚ä½•å•Ÿå‹•è¨“ç·´
# å…§å®¹:
PYTHONPATH=. python -u strength_detection/code/train_sl.py \
  go ${DIR} test.cfg

# èªªæ˜: é€™æ˜¯åŠ©æ•™æä¾›çš„ç¯„ä¾‹ï¼Œå¯¦éš›è¨“ç·´è¦ç”¨ train.py
```

### **åœ¨æµç¨‹ä¸­çš„ä½ç½®**
```
å®Œæ•´å·¥ä½œæµç¨‹:

0. æº–å‚™ç’°å¢ƒ
   $ scripts/start-container.sh
   (é€²å…¥ containerï¼Œå·²å®‰è£æ‰€æœ‰ä¾è³´)

1. ç·¨è­¯
   $ scripts/build.sh go release
   â†’ ç”Ÿæˆ build/go/style_py.so

2. è¨“ç·´
   $ cd style_detection/code
   $ python train.py go my_model -c ../../conf.cfg -d ../../train_set
   â†’ ä½¿ç”¨ build.go.style_py è¼‰å…¥è³‡æ–™
   â†’ è¨“ç·´æ¨¡å‹
   â†’ å„²å­˜åˆ° models/my_model/

3. æ¸¬è©¦
   $ python testing.py go -c ../../conf.cfg
   â†’ è¼‰å…¥æ¨¡å‹
   â†’ æ¨è«– test_set
   â†’ ç”Ÿæˆ submission.csv
```

---

## ğŸ”„ å®Œæ•´å¯¦ä½œæµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éšæ®µ 0: ç’°å¢ƒæº–å‚™                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
    scripts/start-container.sh (å•Ÿå‹• container)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éšæ®µ 1: ç·¨è­¯                                   â”‚
â”‚                                                                   â”‚
â”‚  scripts/build.sh go release                                     â”‚
â”‚    â†“                                                             â”‚
â”‚  CMake è®€å–:                                                      â”‚
â”‚    - ML-Assignment2-Q5/CMakeLists.txt (ä¸»è¨­å®š)                   â”‚
â”‚    - minizero/CMakeLists.txt (å¼•æ“)                              â”‚
â”‚    - style_detection/CMakeLists.txt (ä½œæ¥­)                       â”‚
â”‚    â†“                                                             â”‚
â”‚  ç·¨è­¯é †åº:                                                        â”‚
â”‚    1. minizero/ â†’ libminizero.a                                  â”‚
â”‚    2. style_detection/ â†’ style_py.so â­                          â”‚
â”‚    3. é€£çµæ‰€æœ‰æ¨¡çµ„                                                â”‚
â”‚    â†“                                                             â”‚
â”‚  è¼¸å‡º: build/go/style_py.cpython-*.so                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éšæ®µ 2: å¯¦ä½œæ¨¡å‹                               â”‚
â”‚                                                                   â”‚
â”‚  ä½ è¦å¯«çš„æª”æ¡ˆ:                                                    â”‚
â”‚    1. style_detection/code/encoder/model.py                      â”‚
â”‚       class Encoder(nn.Module):                                  â”‚
â”‚         - __init__: å®šç¾© CNN æ¶æ§‹                                â”‚
â”‚         - forward: å‰å‘å‚³æ’­                                       â”‚
â”‚         - loss: Triplet Loss                                     â”‚
â”‚                                                                   â”‚
â”‚    2. style_detection/code/testing.py                            â”‚
â”‚       - è£œå®Œ inference() æ–¹æ³•                                     â”‚
â”‚       - è£œå®Œ testing() æ–¹æ³•                                       â”‚
â”‚       - ç”Ÿæˆ submission.csv                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éšæ®µ 3: è¨“ç·´                                   â”‚
â”‚                                                                   â”‚
â”‚  cd style_detection/code                                         â”‚
â”‚  python train.py go my_run \                                     â”‚
â”‚    -d ../../train_set \                                          â”‚
â”‚    -c ../../conf.cfg                                             â”‚
â”‚    â†“                                                             â”‚
â”‚  train.py (åŠ©æ•™å®Œæˆ) å‘¼å«:                                        â”‚
â”‚    â”œâ”€ import build.go.style_py                                   â”‚
â”‚    â”œâ”€ style_py.DataLoader() â† C++ æä¾›                           â”‚
â”‚    â”œâ”€ MinizeroDataset (åŠ©æ•™å®Œæˆ)                                 â”‚
â”‚    â”œâ”€ encoder.model.Encoder (ä½ å¯¦ä½œ)                             â”‚
â”‚    â””â”€ è¨“ç·´å¾ªç’°                                                    â”‚
â”‚         â”œâ”€ å–å¾—æ‰¹æ¬¡è³‡æ–™                                           â”‚
â”‚         â”œâ”€ model.forward()                                       â”‚
â”‚         â”œâ”€ model.loss()                                          â”‚
â”‚         â””â”€ optimizer.step()                                      â”‚
â”‚    â†“                                                             â”‚
â”‚  è¼¸å‡º: models/my_run/model_*.pth                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éšæ®µ 4: æ¸¬è©¦                                   â”‚
â”‚                                                                   â”‚
â”‚  python testing.py go -c ../../conf.cfg                          â”‚
â”‚    â†“                                                             â”‚
â”‚  testing.py (ä½ è£œå®Œ) åŸ·è¡Œ:                                        â”‚
â”‚    â”œâ”€ è¼‰å…¥è¨“ç·´å¥½çš„æ¨¡å‹                                            â”‚
â”‚    â”œâ”€ è®€å– query_set/player*.sgf (600å€‹)                         â”‚
â”‚    â”‚   â””â”€ ç”¨ style_py.DataLoader                                â”‚
â”‚    â”œâ”€ æå– query embeddings                                      â”‚
â”‚    â”œâ”€ è®€å– cand_set/player*.sgf (600å€‹)                          â”‚
â”‚    â”œâ”€ æå– candidate embeddings                                  â”‚
â”‚    â”œâ”€ è¨ˆç®— cosine similarity                                     â”‚
â”‚    â”‚   for each query:                                           â”‚
â”‚    â”‚     æ‰¾æœ€ç›¸ä¼¼çš„ candidate                                     â”‚
â”‚    â””â”€ ç”Ÿæˆ submission.csv                                        â”‚
â”‚         query1,cand234                                           â”‚
â”‚         query2,cand567                                           â”‚
â”‚         ...                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ å„ç›®éŒ„çš„ä¾è³´é—œä¿‚

```
ä¾è³´å±¤æ¬¡ (ç”±ä¸‹åˆ°ä¸Š):

Layer 4: Scripts (è‡ªå‹•åŒ–)
  â””â”€â”€ scripts/
       â”œâ”€â”€ build.sh â†’ å‘¼å« CMake
       â””â”€â”€ start-container.sh â†’ å•Ÿå‹•ç’°å¢ƒ

Layer 3: Build Output (ç”¢ç‰©)
  â””â”€â”€ build/go/
       â””â”€â”€ style_py.so â† è¢« Python import

Layer 2: Application (ä½ çš„å·¥ä½œ)
  â””â”€â”€ style_detection/
       â”œâ”€â”€ C++ è³‡æ–™è¼‰å…¥å™¨ â†’ ä½¿ç”¨ Layer 1
       â””â”€â”€ Python è¨“ç·´/æ¸¬è©¦ â†’ ä½¿ç”¨ Layer 3

Layer 1: Engine (åŸºç¤è¨­æ–½)
  â””â”€â”€ minizero/
       â””â”€â”€ åœæ£‹å¼•æ“ã€MCTSã€ç¥ç¶“ç¶²è·¯ä»‹é¢

Layer 0: Config (è¨­å®š)
  â””â”€â”€ conf.cfg
```

---

## ğŸ¯ ç¸½çµ: ä½ éœ€è¦åšä»€éº¼

### âœ… **ä¸éœ€è¦æ”¹çš„ (åŠ©æ•™å®Œæˆ)**
- âŒ minizero/ - å®Œæ•´çš„éŠæˆ²å¼•æ“
- âŒ scripts/ - ç·¨è­¯å’Œå•Ÿå‹•è…³æœ¬
- âŒ style_detection/sd_data_loader.* - è³‡æ–™è¼‰å…¥å™¨
- âŒ style_detection/pybind.cpp - Python ç¶å®š
- âŒ style_detection/code/encoder/train.py - è¨“ç·´æ¡†æ¶

### âš ï¸ **ä½ è¦å¯¦ä½œçš„**
1. **style_detection/code/encoder/model.py** (æ ¸å¿ƒ)
   - è¨­è¨ˆ CNN æ¶æ§‹æå–æ£‹é¢¨ç‰¹å¾µ
   - å¯¦ä½œ Triplet Loss æˆ–å…¶ä»–åº¦é‡å­¸ç¿’æå¤±
   
2. **style_detection/code/testing.py** (æ¨è«–)
   - è£œå®Œæ¨è«–é‚è¼¯
   - ç”Ÿæˆ submission.csv

### ğŸ”§ **ä¾è³´ç·¨è­¯çš„éƒ¨åˆ†**
- **build/go/style_py.so** - å¿…é ˆæˆåŠŸç·¨è­¯æ‰èƒ½ç”¨
  - éœ€è¦: podman + container image
  - æˆ–: ç›´æ¥åœ¨æœ‰å®Œæ•´ç’°å¢ƒçš„æ©Ÿå™¨ä¸Šç·¨è­¯

---

ç¾åœ¨ä¸‹è¼‰é‚„åœ¨é€²è¡Œå—ï¼Ÿè¦æˆ‘å¹«ä½ æª¢æŸ¥é€²åº¦æˆ–é–‹å§‹è¨­è¨ˆ model.py å—ï¼Ÿ
